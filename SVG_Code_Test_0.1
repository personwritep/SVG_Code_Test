// ==UserScript==
// @name        SVG Code Test ğŸ”µ
// @namespace        http://tampermonkey.net/
// @version        0.1
// @description        SVGç”»åƒã‚³ãƒ¼ãƒ‰ã®è¡¨ç¤ºãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹ ã€ŒScroll Lockã€
// @author        Ameba Blog User
// @match        https://ameblo.jp/*
// @icon        https://www.google.com/s2/favicons?sz=64&domain=ameblo.jp
// @noframes
// @grant        none
// ==/UserScript==



let target=document.querySelector('head > title');
let monitor=new MutationObserver(main);
monitor.observe(target, { childList: true });

main();

function main(){
    let display=0;
    let bg_url='';
    let stack_g=[];

    window.addEventListener('keydown', check_key);
    function check_key(event){
        if(event.keyCode==145){ // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã€ŒScroll Lockã€
            event.preventDefault();
            event.stopImmediatePropagation();
            if(display==0){
                display=1;
                disp(); }
            else{
                display=0;
                disp_close(); }}}



    function disp(){

        let disp_p=
            '<div id="test_panel">'+
            '<div id="w_img"><div id="t_img0"></div><div id="t_img1"></div></div>'+
            '<textarea id="code" cols="" rows="" wrap="soft"></textarea>'+
            '<style>#test_panel { position: fixed; top: 100px; left: 40px; z-index: calc(infinity); '+
            'width: min-content; display: flex; flex-direction: row; flex-wrap: wrap; '+
            'padding: 30px 0 10px; border: 1px solid #aaa; background: #fff; } '+
            '#w_img { display: flex; width: 100%; } '+
            '#t_img0, #t_img1 { width: 200px; height: 200px; margin: 0 20px; '+
            'border: 1px solid #aaa; } '+
            '#t_img0 { margin: 0 20px; } '+
            '#t_img1 { margin: 0 10px 0 20px; } '+
            '#t_img0::before { content: "svg"; position: absolute; top: 3px; } '+
            '#t_img0 svg { width: 200px; height: 200px; } '+
            '#t_img1::before { content: "background svg"; position: absolute; top: 3px; } '+
            '#t_img1 { width: 200px; height: 200px; } '+
            '#code { width: 600px; height: calc(100vh - 480px); '+
            'margin: 20px 20px; padding: 10px 15px; } '+
            '</style></div>';

        if(document.querySelector('#test_panel')){
            document.querySelector('#test_panel').remove(); }
        document.body.insertAdjacentHTML('beforeend', disp_p);


        let code=document.querySelector('#code');
        if(code){
            code.addEventListener('change', function(){
                text_img(code); }); }

    } // disp()



    function disp_close(){
        if(document.querySelector('#test_panel')){
            document.querySelector('#test_panel').remove(); }}



    function text_img(code){
        let t_img0=document.querySelector('#test_panel #t_img0');
        if(t_img0){
            t_img0.innerHTML=''; } // åˆæœŸåŒ–

        let t_img1_style_=document.querySelector('.t_img1_style');
        if(t_img1_style_){
            t_img1_style_.remove(); } // åˆæœŸåŒ–


        let img_code=code.value; // ã‚³ãƒ¼ãƒ‰å–å¾—

        get_text0(img_code); //ã€Œ'ã€ã‚¿ã‚¤ãƒ—ã‚³ãƒ¼ãƒ‰
        let stack_str0=stack_g.join('');
        t_img0.innerHTML=stack_str0;


        get_text1(img_code); //ã€Œ"ã€ã‚¿ã‚¤ãƒ—ã‚³ãƒ¼ãƒ‰
        let stack_str1=stack_g.join('');
        let t_img1=document.querySelector('#test_panel #t_img1');
        if(t_img1){
            let style=
                '<style class="t_img1_style">'+
                '#t_img1 { background: url("'+ stack_str1 +'"); '+
                'background-repeat: no-repeat; background-size: cover; } '+
                '</style>';

            if(document.querySelector('.t_img1_style')){
                document.querySelector('.t_img1_style').remove(); }
            t_img1.insertAdjacentHTML('afterend', style); }

    } // text_img(code)



    function get_text0(text){
        let count=text.match(/'/g).length
        if(count%2==1){ //ã€Œ'ã€ã«ç«¯æ•°ãŒã‚ã‚‹
            alert("å‡¦ç†å¯¾è±¡ã‚³ãƒ¼ãƒ‰ã®åˆ‡å‡ºã—æ–¹ã«å•é¡Œã‚ã‚Š ã€Œ'ã€ãŒå¥‡æ•°ã§ã™"); }
        else{
            let top_str=text.substring(0, text.indexOf("'"));
            if(top_str){ // æœ€åˆã®ã€Œ'ã€ã‚ˆã‚Šæ‰‹å‰ã«æ–‡å­—ãŒã‚ã‚‹
                top_str=top_str.replace(/\s/g,'');
                if(top_str.length>0){ // æœ€åˆã®ã€Œ'ã€ã‚ˆã‚Šæ‰‹å‰ã«åŠè§’ç©ºç™½ä»¥å¤–ã®æ–‡å­—ãŒã‚ã‚‹
                    alert('å‡¦ç†å¯¾è±¡ã‚³ãƒ¼ãƒ‰ã‚’ã€Œ"ã€ã‚¿ã‚¤ãƒ—ã¨ã—ã¦å‡¦ç†ã—ã¾ã™'); }
                else{ // æœ€åˆã®ã€Œ'ã€ã‚ˆã‚Šæ‰‹å‰ã«åŠè§’ç©ºç™½ä»¥å¤–ã®æ–‡å­—ãŒãªã„
                    clean0(text); }}
            else{ // æœ€åˆã®ã€Œ'ã€ã‚ˆã‚Šæ‰‹å‰ã«æ–‡å­—ãŒãªã„
                clean0(text); }


            function clean0(text){
                let t_img1_style_=document.querySelector('.t_img1_style');
                if(t_img1_style_){
                    t_img1_style_.remove(); } // åˆæœŸåŒ–

                stack_g=[]; // ã‚³ãƒ¼ãƒ‰æ–‡å­—ã®é…åˆ—ã‚’ãƒªã‚»ãƒƒãƒˆ
                for(let index=0; true;){
                    let s=text.indexOf("'", index); // indexä½ç½®ã‹ã‚‰æ¤œç´¢
                    if(s==-1){ break; } //ã€Œ'ã€ãŒãªã‘ã‚Œã°çµ‚äº†
                    let e=text.indexOf("'", s+1); // ç™ºè¦‹ã—ãŸä½ç½®ã‚ˆã‚Šå¾Œæ–¹ã®ã€Œ'ã€ã‚’æ¤œç´¢
                    if(e==-1){ break; } //ã€Œ'ã€ãŒãªã‘ã‚Œã°çµ‚äº†
                    stack_g.push(text.substring(s+1, e)); // s e ã®ä½ç½®ã‚’åˆ‡å‡ºã™
                    index=e+1; }
                return stack_g; }}

    } // get_text0()



    function get_text1(text){
        let count=text.match(/"/g).length
        if(count%2==1){ //ã€Œ"ã€ã«ç«¯æ•°ãŒã‚ã‚‹
            alert('å‡¦ç†å¯¾è±¡ã‚³ãƒ¼ãƒ‰ã®åˆ‡å‡ºã—æ–¹ã«å•é¡Œã‚ã‚Š ã€Œ"ã€ãŒå¥‡æ•°ã§ã™'); }
        else{
            let top_str=text.substring(0, text.indexOf('"'));
            if(top_str){ // æœ€åˆã®ã€Œ"ã€ã‚ˆã‚Šæ‰‹å‰ã«æ–‡å­—ãŒã‚ã‚‹
                top_str=top_str.replace(/\s/g,'');
                if(top_str.length>0){ // æœ€åˆã®ã€Œ"ã€ã‚ˆã‚Šæ‰‹å‰ã«åŠè§’ç©ºç™½ä»¥å¤–ã®æ–‡å­—ãŒã‚ã‚‹
                    alert("å‡¦ç†å¯¾è±¡ã‚³ãƒ¼ãƒ‰ã‚’ã€Œ'ã€ã‚¿ã‚¤ãƒ—ã¨ã—ã¦å‡¦ç†ã—ã¾ã™"); }
                else{ // æœ€åˆã®ã€Œ"ã€ã‚ˆã‚Šæ‰‹å‰ã«åŠè§’ç©ºç™½ä»¥å¤–ã®æ–‡å­—ãŒãªã„
                    clean1(text); }}
            else{ // æœ€åˆã®ã€Œ'ã€ã‚ˆã‚Šæ‰‹å‰ã«æ–‡å­—ãŒãªã„
                clean1(text); }


            function clean1(text){
                let t_img0=document.querySelector('#test_panel #t_img0');
                if(t_img0){
                    t_img0.innerHTML=''; } // åˆæœŸåŒ–

                stack_g=[]; // ã‚³ãƒ¼ãƒ‰æ–‡å­—ã®é…åˆ—ã‚’ãƒªã‚»ãƒƒãƒˆ
                for(let index=0; true;){
                    let s=text.indexOf('"', index); // indexä½ç½®ã‹ã‚‰æ¤œç´¢
                    if(s==-1){ break; } //ã€Œ"ã€ãŒãªã‘ã‚Œã°çµ‚äº†
                    let e=text.indexOf('"', s+1); // ç™ºè¦‹ã—ãŸä½ç½®ã‚ˆã‚Šå¾Œæ–¹ã®ã€Œ"ã€ã‚’æ¤œç´¢
                    if(e==-1){ break; } //ã€Œ"ã€ãŒãªã‘ã‚Œã°çµ‚äº†
                    stack_g.push(text.substring(s+1, e)); // s e ã®ä½ç½®ã‚’åˆ‡å‡ºã™
                    index=e+1; }
                return stack_g; }}

    } // get_text1()

} // main()




/* ã‚³ãƒ¼ãƒ‰ã‚µãƒ³ãƒ—ãƒ«
    â— é€šå¸¸ã®SVG

                '<svg xmlns="http://www.w3.org/2000/svg" '+
                'width="26" height="26" viewBox="0 0 64 64" style="fill: #009688;">'+
                '<g transform="translate(0,64) scale(0.1,-0.1)">'+
                '<path d="M212 558 c-7 -7 -12 -35 -12 -64 0 -28 -7 -68 -15 -87 -8 '+
                '-20 -15 -66 -15 -104 0 -61 -3 -69 -27 -89 -32 -25 -27 -60 8 -49 14 '+
                '5 25 2 30 -6 8 -11 12 -10 24 5 15 20 15 20 15 -1 0 -11 -9 -28 -20 -38 '+
                '-31 -28 -8 -47 54 -43 44 3 51 6 54 25 4 30 20 30 24 1 3 -20 10 -23 54 '+
                '-26 62 -4 85 15 54 43 -11 10 -20 27 -20 38 0 21 0 21 15 1 12 -15 16 '+
                '-16 24 -5 5 8 16 11 30 6 35 -11 40 24 8 49 -25 20 -27 28 -27 91 -1 39 '+
                '-7 88 -15 110 -8 22 -15 61 -15 86 0 30 -6 51 -15 59 -13 11 -21 8 -48 '+
                '-18 -42 -41 -75 -41 -112 -2 -32 34 -36 35 -53 18z m38 -148 c0 -5 -4 '+
                '-10 -10 -10 -5 0 -10 5 -10 10 0 6 5 10 10 10 6 0 10 -4 10 -10z m150 '+
                '0 c0 -5 -4 -10 -10 -10 -5 0 -10 5 -10 10 0 6 5 10 10 10 6 0 10 -4 10 '+
                '-10z m-103 -28 c-19 -20 -7 -42 23 -42 30 0 42 22 23 42 -16 18 -16 18 '+
                '3 12 26 -9 64 -45 64 -60 0 -6 -7 -18 -16 -25 -14 -11 -21 -11 -45 3 -27 '+
                '16 -31 16 -58 0 -24 -14 -31 -14 -45 -3 -9 7 -16 19 -16 25 0 20 48 59 '+
                '79 65 2 1 -3 -7 -12 -17z m61 -128 c33 -23 27 -73 -10 -94 -25 -13 -31 '+
                '-13 -55 0 -38 21 -44 71 -11 94 12 9 29 16 38 16 9 0 26 -7 38 -16z"/>'+
                '</g></svg>';


    â— Background ã®URLã‚¿ã‚¤ãƒ—

                "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' "+
                "width='26' height='26' viewBox='0 0 64 64' style='fill: %23009688;'>"+
                "<g transform='translate(0,64) scale(0.1,-0.1)'>"+
                "<path d='M212 558 c-7 -7 -12 -35 -12 -64 0 -28 -7 -68 -15 -87 -8 -20 -15 -66"+
                " -15 -104 0 -61 -3 -69 -27 -89 -32 -25 -27 -60 8 -49 14 5 25 2 30 -6 8 -11 1"+
                "2 -10 24 5 15 20 15 20 15 -1 0 -11 -9 -28 -20 -38 -31 -28 -8 -47 54 -43 44 3"+
                " 51 6 54 25 4 30 20 30 24 1 3 -20 10 -23 54 -26 62 -4 85 15 54 43 -11 10 -20"+
                " 27 -20 38 0 21 0 21 15 1 12 -15 16 -16 24 -5 5 8 16 11 30 6 35 -11 40 24 8 "+
                "49 -25 20 -27 28 -27 91 -1 39 -7 88 -15 110 -8 22 -15 61 -15 86 0 30 -6 51 -"+
                "15 59 -13 11 -21 8 -48 -18 -42 -41 -75 -41 -112 -2 -32 34 -36 35 -53 18z m38"+
                " -148 c0 -5 -4 -10 -10 -10 -5 0 -10 5 -10 10 0 6 5 10 10 10 6 0 10 -4 10 -10"+
                "z m150 0 c0 -5 -4 -10 -10 -10 -5 0 -10 5 -10 10 0 6 5 10 10 10 6 0 10 -4 10 "+
                "-10z m-103 -28 c-19 -20 -7 -42 23 -42 30 0 42 22 23 42 -16 18 -16 18 3 12 26"+
                " -9 64 -45 64 -60 0 -6 -7 -18 -16 -25 -14 -11 -21 -11 -45 3 -27 16 -31 16 -5"+
                "8 0 -24 -14 -31 -14 -45 -3 -9 7 -16 19 -16 25 0 20 48 59 79 65 2 1 -3 -7 -12"+
                " -17z m61 -128 c33 -23 27 -73 -10 -94 -25 -13 -31 -13 -55 0 -38 21 -44 71 -1"+
                "1 94 12 9 29 16 38 16 9 0 26 -7 38 -16z'></path>"+
                "</g>"+
                "</svg>";

*/

